---
name: Vehicle Check-out and Billing
status: open
created: 2025-08-31T20:37:15Z
updated: 2025-08-31T20:47:15Z
github: https://github.com/iaminawe/ParkingGarage/issues/7
depends_on: [3, 6]
parallel: false
conflicts_with: [6]
---

# Task: Vehicle Check-out and Billing

## Description
Implement the vehicle check-out functionality including license plate lookup, parking duration calculation, fee computation based on rates, spot release, and parking record cleanup. This completes the parking transaction lifecycle.

## Acceptance Criteria
- [ ] POST /api/v1/checkout processes vehicle exit
- [ ] Finds vehicle by license plate
- [ ] Calculates parking duration accurately
- [ ] Computes fees based on hourly rates
- [ ] Releases spot (marks as available)
- [ ] Returns itemized bill with duration and fees
- [ ] Removes vehicle record from active parking
- [ ] Handles vehicle not found gracefully

## Technical Details
- Implement duration calculation (rounded up to nearest hour)
- Apply spot-type specific rates
- Handle special pricing (EV charging premium)
- Ensure atomic spot release
- Archive parking records (optional for history)

**Files to create/modify:**
- `src/routes/checkout.js` - Check-out route
- `src/controllers/checkoutController.js` - Check-out logic
- `src/services/checkoutService.js` - Check-out business service
- `src/services/billingService.js` - Fee calculation service
- `src/middleware/validation/checkoutValidation.js` - Input validation
- `src/utils/timeCalculator.js` - Duration calculation utilities

**API Endpoint:**
```javascript
// POST /api/v1/checkout
// Body: {
//   licensePlate: "ABC123"
// }
// Response: {
//   success: true,
//   licensePlate: "ABC123",
//   spotId: "F1-B2-S015",
//   checkInTime: "2024-01-01T10:00:00Z",
//   checkOutTime: "2024-01-01T14:30:00Z",
//   duration: {
//     hours: 4,
//     minutes: 30,
//     billableHours: 5  // rounded up
//   },
//   billing: {
//     ratePerHour: 5.00,
//     totalHours: 5,
//     totalAmount: 25.00
//   },
//   message: "Thank you for parking with us!"
// }
```

**Billing Rules:**
- Round up to nearest hour for billing
- Apply spot-type specific rates
- Minimum charge: 1 hour
- EV charging spots: +$3/hour premium
- Future: Implement grace period (5 minutes free)

## Dependencies
- [ ] Task 3 - Data models available
- [ ] Task 6 - Check-in system complete

## Effort Estimate
- Size: M
- Hours: 4-5 hours
- Parallel: false (depends on check-in)

## Definition of Done
- [ ] Check-out endpoint functional
- [ ] Duration calculation accurate
- [ ] Billing calculation correct
- [ ] Spot released atomically
- [ ] Vehicle record removed
- [ ] Validation and error handling complete
- [ ] Integration tests passing
- [ ] Edge cases handled (vehicle not found, negative duration)
