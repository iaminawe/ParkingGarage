---
name: Search and Query Features
status: open
created: 2025-08-31T20:37:15Z
updated: 2025-08-31T20:47:15Z
github: https://github.com/iaminawe/ParkingGarage/issues/8
depends_on: [3, 5]
parallel: true
conflicts_with: []
---

# Task: Search and Query Features

## Description
Implement advanced search and query capabilities including vehicle lookup by license plate, availability statistics by floor/bay, occupancy reports, and basic analytics. These features provide operational insights and support customer service scenarios.

## Acceptance Criteria
- [ ] GET /api/v1/vehicles/:licensePlate finds parked vehicles
- [ ] GET /api/v1/vehicles supports partial plate search
- [ ] GET /api/v1/stats returns garage occupancy statistics
- [ ] GET /api/v1/stats/floor/:id returns floor-specific stats
- [ ] Statistics include counts by spot type
- [ ] Real-time occupancy percentage calculated
- [ ] Average parking duration tracked
- [ ] Peak usage times identified (bonus)

## Technical Details
- Implement efficient search using Map lookups
- Support fuzzy/partial matching for license plates
- Calculate statistics on-demand (avoid caching initially)
- Aggregate data by floor, bay, and spot type

**Files to create/modify:**
- `src/routes/vehicles.js` - Vehicle search routes
- `src/routes/stats.js` - Statistics routes
- `src/controllers/vehicleController.js` - Vehicle search logic
- `src/controllers/statsController.js` - Statistics logic
- `src/services/searchService.js` - Search algorithms
- `src/services/analyticsService.js` - Statistics calculations
- `src/utils/stringMatcher.js` - Fuzzy matching utility

**API Endpoints:**
```javascript
// GET /api/v1/vehicles/:licensePlate
// Response: {
//   found: true,
//   vehicle: {
//     licensePlate: "ABC123",
//     spotId: "F1-B2-S015",
//     checkInTime: "...",
//     currentDuration: { hours: 2, minutes: 30 }
//   }
// }

// GET /api/v1/vehicles?search=ABC
// Response: {
//   matches: [...],
//   count: 3
// }

// GET /api/v1/stats
// Response: {
//   totalSpots: 180,
//   occupiedSpots: 87,
//   availableSpots: 93,
//   occupancyRate: 48.33,
//   byType: {
//     compact: { total: 60, occupied: 25 },
//     standard: { total: 100, occupied: 52 },
//     oversized: { total: 20, occupied: 10 }
//   },
//   byFloor: [
//     { floor: 1, occupancy: 55.0, available: 27 }
//   ],
//   averageDuration: { hours: 3, minutes: 15 }
// }
```

## Dependencies
- [ ] Task 3 - Data models available
- [ ] Task 5 - Spot operations complete

## Effort Estimate
- Size: M
- Hours: 3-4 hours
- Parallel: true (independent feature)

## Definition of Done
- [ ] Vehicle search working (exact and partial)
- [ ] Statistics endpoints return accurate data
- [ ] Floor-level statistics available
- [ ] Occupancy rates calculated correctly
- [ ] Performance acceptable for large datasets
- [ ] Error handling for edge cases
- [ ] API tests written
- [ ] Documentation updated
